import java.util.List;
import java.util.stream.Collectors;
import java.util.ArrayList;
import java.util.Arrays;

public class TrainingTester {

	public static void main(String[] args) {
		// TODO Auto-generated method stub
/**		The data_set will have 9 inputs (3 will not be supported) and 1 expected output:
 *  Inputs:
 *  average dollar value over the past 2 days,
 *  average dollar value over the past 7 days,
 *  average TSX index over the past 2 days,
 *  average TSX index over the past 7 days,
 *  current degree of ”political instability”,			-- Not supported
 *  change in price of crude oil over past 2 days,		-- Not supported
 *  change in price of crude oil over past 7 days, 		-- Not supported
 *  change in price of gold over past 2 days, 
 *  change in price of gold over past 7 days,
 *  
 *  The output would be the change in the CAD value in USD currency in the next 2 days


*/
		double[][] data_set_1 = {
			{0.7601, 0.7583571428571428, 0.555654743282267, 0.4332791586295705, 0.006329113924053105, 0.12658227848101275, 0.0018999999999999018},
			{0.7598499999999999, 0.7575571428571428, 0.5129731196960057, 0.4257978747203397, -0.01627486437613186, 0.5994575045207937, -0.0019000000000000128},
			{0.75895, 0.7573714285714286, 0.3463996645180508, 0.4547311777864146, 0.09855334538878933, -0.08499095840868082, -0.0021999999999999797},
			{0.7587999999999999, 0.7571, 0.13841093339884336, 0.3656022659741861, -0.0904159132007234, -0.4828209764918638, -0.000500000000000056},
			{0.75755, 0.7561857142857143, 0.49657018123122204, 0.4652402058362493, 0.0976491862567788, -0.06329113924050637, -0.0018000000000000238},
			{0.7556499999999999, 0.7551142857142857, 0.47998089448530856, 0.48272556639217956, 0.05605786618445097, -0.11754068716094042, -0.00029999999999996696},
			{0.7547999999999999, 0.7547142857142858, 0.4767800801129881, 0.37926030115979337, -0.025316455696204197, -0.2658227848101276, -0.0024999999999999467},
			{0.75665, 0.7544000000000001, 0.6307368103312214, 0.46730828458587936, 0.47920433996383405, 0.06600361663652973, -0.0038000000000000256},
			{0.75825, 0.7542142857142857, 0.3022884890844683, 0.5010386329307902, -0.7007233273056064, -0.5461121157323702, -0.0017000000000000348},
			{0.7547999999999999, 0.7534285714285714, 0.3831812626924723, 0.5419441886226889, -0.2992766726943936, 0.2323688969258616, 0.0037000000000000366},
			{0.75185, 0.7526285714285714, 0.5483424848618204, 0.6466462435330357, 0.329113924050634, 0.3508137432188084, 0.0031999999999999806},
			{0.7524, 0.7525857142857143, 0.19564051486362613, 0.581430468864007, 0.04339963833634477, 0.016274864376127747, -0.006900000000000017},
			{0.75315, 0.7527428571428572, 0.426020408163258, 0.6261192381739283, -0.09222423146473623, -0.24412296564195318, -0.005899999999999905},
			{0.75305, 0.7525285714285714, 0.903004241311477, 0.7052685796645961, 0.30650994575045315, -0.08137432188065107, 0.0010999999999999899},
			{0.75325, 0.7526142857142857, 0.8919624744600545, 0.6804668303934643, -0.13291139240506586, -0.20162748643761483, 0.0014999999999999458}
		};
		
		double[][] data_set_1_non_negative = {
			{0.7601, 0.7583571428571428, 0.555654743282267, 0.4332791586295705, 0.006329113924053105, 0.12658227848101275, 0.0018999999999999018},
			{0.7598499999999999, 0.7575571428571428, 0.5129731196960057, 0.4257978747203397, 0.01627486437613186, 0.5994575045207937, 0.0019000000000000128},
			{0.75895, 0.7573714285714286, 0.3463996645180508, 0.4547311777864146, 0.09855334538878933, 0.08499095840868082, 0.0021999999999999797},
			{0.7587999999999999, 0.7571, 0.13841093339884336, 0.3656022659741861, 0.0904159132007234, 0.4828209764918638, 0.000500000000000056},
			{0.75755, 0.7561857142857143, 0.49657018123122204, 0.4652402058362493, 0.0976491862567788, 0.06329113924050637, 0.0018000000000000238},
			{0.7556499999999999, 0.7551142857142857, 0.47998089448530856, 0.48272556639217956, 0.05605786618445097, 0.11754068716094042, 0.00029999999999996696},
			{0.7547999999999999, 0.7547142857142858, 0.4767800801129881, 0.37926030115979337, 0.025316455696204197, 0.2658227848101276, 0.0024999999999999467},
			{0.75665, 0.7544000000000001, 0.6307368103312214, 0.46730828458587936, 0.47920433996383405, 0.06600361663652973, 0.0038000000000000256},
			{0.75825, 0.7542142857142857, 0.3022884890844683, 0.5010386329307902, 0.7007233273056064, 0.5461121157323702, 0.0017000000000000348},
			{0.7547999999999999, 0.7534285714285714, 0.3831812626924723, 0.5419441886226889, 0.2992766726943936, 0.2323688969258616, 0.0037000000000000366},
			{0.75185, 0.7526285714285714, 0.5483424848618204, 0.6466462435330357, 0.329113924050634, 0.3508137432188084, 0.0031999999999999806},
			{0.7524, 0.7525857142857143, 0.19564051486362613, 0.581430468864007, 0.04339963833634477, 0.016274864376127747, 0.006900000000000017},
			{0.75315, 0.7527428571428572, 0.426020408163258, 0.6261192381739283, 0.09222423146473623, 0.24412296564195318, 0.005899999999999905},
			{0.75305, 0.7525285714285714, 0.903004241311477, 0.7052685796645961, 0.30650994575045315, 0.08137432188065107, 0.0010999999999999899},
			{0.75325, 0.7526142857142857, 0.8919624744600545, 0.6804668303934643, 0.13291139240506586, 0.20162748643761483, 0.0014999999999999458}
		};
		
		double[][] data_set_2 = {
			{0.7601, 0.7583571428571428, 0.555654743282267, 0.4332791586295705, 0.006329113924053105, 0.12658227848101275, 0.0019},
			{0.7598499999999999, 0.7575571428571428, 0.5129731196960057, 0.4257978747203397, -0.01627486437613186, 0.5994575045207937, -0.0019},
			{0.75895, 0.7573714285714286, 0.3463996645180508, 0.4547311777864146, 0.09855334538878933, -0.08499095840868082, -0.0022},
			{0.7587999999999999, 0.7571, 0.13841093339884336, 0.3656022659741861, -0.0904159132007234, -0.4828209764918638, -0.0005},
			{0.75755, 0.7561857142857143, 0.49657018123122204, 0.4652402058362493, 0.0976491862567788, -0.06329113924050637, -0.0018},
			{0.7556499999999999, 0.7551142857142857, 0.47998089448530856, 0.48272556639217956, 0.05605786618445097, -0.11754068716094042, -0.0003},
			{0.7547999999999999, 0.7547142857142858, 0.4767800801129881, 0.37926030115979337, -0.025316455696204197, -0.2658227848101276, -0.0025},
			{0.75665, 0.7544000000000001, 0.6307368103312214, 0.46730828458587936, 0.47920433996383405, 0.06600361663652973, -0.0038},
			{0.75825, 0.7542142857142857, 0.3022884890844683, 0.5010386329307902, -0.7007233273056064, -0.5461121157323702, -0.0017},
			{0.7547999999999999, 0.7534285714285714, 0.3831812626924723, 0.5419441886226889, -0.2992766726943936, 0.2323688969258616, 0.0037},
			{0.75185, 0.7526285714285714, 0.5483424848618204, 0.6466462435330357, 0.329113924050634, 0.3508137432188084, 0.0032},
			{0.7524, 0.7525857142857143, 0.19564051486362613, 0.581430468864007, 0.04339963833634477, 0.016274864376127747, -0.0069},
			{0.75315, 0.7527428571428572, 0.426020408163258, 0.6261192381739283, -0.09222423146473623, -0.24412296564195318, -0.0059},
			{0.75305, 0.7525285714285714, 0.903004241311477, 0.7052685796645961, 0.30650994575045315, -0.08137432188065107, 0.0011},
			{0.75325, 0.7526142857142857, 0.8919624744600545, 0.6804668303934643, -0.13291139240506586, -0.20162748643761483, 0.0015}
		};
		
		double[][] data_set_2_non_negative = {
			{0.7601, 0.7583571428571428, 0.555654743282267, 0.4332791586295705, 0.006329113924053105, 0.12658227848101275, 0.0019},
			{0.7598499999999999, 0.7575571428571428, 0.5129731196960057, 0.4257978747203397, 0.01627486437613186, 0.5994575045207937, 0.0019},
			{0.75895, 0.7573714285714286, 0.3463996645180508, 0.4547311777864146, 0.09855334538878933, 0.08499095840868082, 0.0022},
			{0.7587999999999999, 0.7571, 0.13841093339884336, 0.3656022659741861, 0.0904159132007234, 0.4828209764918638, 0.0005},
			{0.75755, 0.7561857142857143, 0.49657018123122204, 0.4652402058362493, 0.0976491862567788, 0.06329113924050637, 0.0018},
			{0.7556499999999999, 0.7551142857142857, 0.47998089448530856, 0.48272556639217956, 0.05605786618445097, 0.11754068716094042, 0.0003},
			{0.7547999999999999, 0.7547142857142858, 0.4767800801129881, 0.37926030115979337, 0.025316455696204197, 0.2658227848101276, 0.0025},
			{0.75665, 0.7544000000000001, 0.6307368103312214, 0.46730828458587936, 0.47920433996383405, 0.06600361663652973, 0.0038},
			{0.75825, 0.7542142857142857, 0.3022884890844683, 0.5010386329307902, 0.7007233273056064, 0.5461121157323702, 0.0017},
			{0.7547999999999999, 0.7534285714285714, 0.3831812626924723, 0.5419441886226889, 0.2992766726943936, 0.2323688969258616, 0.0037},
			{0.75185, 0.7526285714285714, 0.5483424848618204, 0.6466462435330357, 0.329113924050634, 0.3508137432188084, 0.0032},
			{0.7524, 0.7525857142857143, 0.19564051486362613, 0.581430468864007, 0.04339963833634477, 0.016274864376127747, 0.0069},
			{0.75315, 0.7527428571428572, 0.426020408163258, 0.6261192381739283, 0.09222423146473623, 0.24412296564195318, 0.0059},
			{0.75305, 0.7525285714285714, 0.903004241311477, 0.7052685796645961, 0.30650994575045315, 0.08137432188065107, 0.0011},
			{0.75325, 0.7526142857142857, 0.8919624744600545, 0.6804668303934643, 0.13291139240506586, 0.20162748643761483, 0.0015}	
		};
		
		
		double[][] data_set = data_set_1;
		BackPropagationNeuronNetwork network = new BackPropagationNeuronNetwork();
		network.setLearningRate(0.1);
		network.setExpectedError(0.0001);
		network.addInputLayer(data_set[0].length - 1);
		network.addHiddenLayer(3);
		network.addHiddenLayer(5);
		network.addOutputLayer(1);
		network.assigningWeight();
		
		// Begin the training.
		int trial = 0;
		while (network.getError() == 0 || network.getError() > network.getExpectedError()) {
			System.out.println("Trial " + trial + ": ");
			network.resetError();
			for (int i = 0; i < data_set.length; i ++) {
				double[] dataset = data_set[i];
				double[] status = {dataset[dataset.length - 1]};
				List<Double> inputs = new ArrayList<Double>();
				for (int j = 0; j < dataset.length - 1; j ++)
					inputs.add(dataset[j]);
				network.addInputNeurons(inputs);
				network.forwardPropogation();
				// Propagate back the error from top layer to the lower layer.
				network.calculateError(status);
				network.errorBackPropagation();
			}
			System.out.println("Error: " + network.getError());
			System.out.println("Weights: \n" + network.getWeights());
			trial ++;
		}
		
		double[] prediction_dataset = {0.76215, 0.7602142857142857, 0.6735153277750959, 0.48857471099808114, 0.10669077757685115, 0.07052441229656178};
		network.addInputNeurons(Arrays.stream(prediction_dataset).boxed().collect(Collectors.toList()));
		network.forwardPropogation();
		
		System.out.println("-------------------------------------");
//		double expected_output = 0.0011;
		double cad_usd_dec_20 = 0.7606;
		double cad_usd_dec_24 = 0.7595;
		double change = network.outputLayer.getNeuron(0).output;
		System.out.println("Change in the value of CAD compared with USD in Dec 24 according to Dec 20: \n" + change);
		
//		System.out.println("Difference:" + (expected_output -  network.outputLayer.getNeuron(0).output));
		System.out.println("The predicted value of CAD/USD in Dec 24 2019 is " + (cad_usd_dec_20 + change) + " or " + (cad_usd_dec_20 - change));
		System.out.println("The real value of CAD/USD in Dec 24 2019 is " + cad_usd_dec_24);
		
	}

}
